---
title: Vue-(3) axios(심화)
layout: single
author_profile: true
read_time: true
comments: true
share: true
related: true
categories:
- Vue
toc: true
toc_sticky: true
toc_label: 목차
---

# 튜토리얼 요약
### axios란 
- 동적으로 데이터를 가져오기 위한 라이브러리
- Promise 기반의 API 형식
- Promis란 비동기 로직 처리에 유용한 자바스크립트 객체이다

|API유형|처리결과|
|:-------------------------:|:-------------------------------:|
|axios.get('URL주소').then().catch()|해당 URL로 get방식으로 요청,then()안에 반환값 로직 작성,catch()안에는 오류발생시 로직 작성|
|axios.post('URL주소').then().catch()|해당 URL로 POST방식으로 요청,then()안에 반환값 로직 작성,catch()안에는 오류발생시 로직 작성|
|axios({옵션})| HTTP요청에 대한 자세한 속성들을 직접 정의하여 보낼 수 있음|

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    
    <div id="app">
        <label for="standard">Choose a standard!: </label>
        <select name="standard" v-model="info">
            <option v-for="(value, key) in model[0]" :value="key">{{key}}</option>
        </select>
        <template v-if="standard">
            <select v-model="check">
                <option v-for="value in set[standard]" :value="value">{{value}}</option>
            </select>
            <table border="1" style="border-collapse: collapse;">
                <th v-for="(value, key) in model[0]">{{key}}</th>
                <tr v-for="value in model" v-if="value[standard]==check">
                    <td v-for=" employee in value">{{employee}}</td>
                </tr>
            </table>
        </template>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script>
        printEmployee();
        let vm = new Vue({
            el: "#app",
            data: {
                standard: "",
                check: "",
                model: [],
                set: {}
            },
            computed: {
                info: {
                    set: function (v) {
                        this.standard = v;
                        this.check = "";
                    },
                    get: function (v) {
                        this.check = "";
                    }
                }
            }
        });

        function printEmployee() {
            axios.get("http://localhost/step11_BackLogic/Controller?command=getAll", {
            }).then(resData => {
                vm.$data.model = resData.data;

                let modelSet = {};
                for (let value of resData.data) {
                    for (let key in value) {
                        if (key in modelSet) {
                            modelSet[key].add(value[key]);
                        } else {
                            modelSet[key] = new Set([value[key]]);
                        }
                    }
                }
                vm.$data.set = modelSet;
            }).catch(error => console.log(error)
            );
        }
    </script>
</body>
</html>


<!--
* 구현 로직 *
1. id/pw가 hr인 오라클 계정의 employees table 검색
    - all query
2. 서비스 로직
    1. 검색된 모든 자료를 다 출력
    2. employees table의 특정 컬럼을 스스로 지정해서 필터링 하고자 하는 로직 선별
    3. 입력시 동적으로 합? 평균? 등등의 수치 연산
    ...
3. 제약
    1. db의 검색 결과는 반드시 json 포멧으로 client에게 응답 ??? json-simple?
    2. json 관련 library 사용 필수 ??? 
    3. mvc pattern 미고려 가능, 프로젝트시에는 필수
        - jsp 하나로 다 처리하셔도 됨
    4. vue.js로 화면단 처리
    5. back end는 반드시 eclipse로 별도의 server
    6. front end는 반드시 vsc로 별도의 server
        5,6번 서버가 다르다
        도메인이 다르다 
        소통의 해결책 : CORS
    7. 비동기 필수 (axios 쓰기)

    발표까지 포함
-->

```

자바 이클립스에 있었던 코드 
## index.jsp
```jsp
<%@page import="model.EmployeesDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<% response.setHeader("Access-Control-Allow-Origin", "*"); %>

${requestScope.employeesAll.allEmployees}
```


## Controller.java
```java
package controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import model.EmployeesDAO;
import model.dto.Employees;
import net.sf.json.JSONArray;
import net.sf.json.JSONException;
import net.sf.json.JSONObject;

@WebServlet("/Controller")
public class Controller extends HttpServlet {
	protected void service(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		request.setCharacterEncoding("utf-8");
		String command = request.getParameter("command");

		try {
			if (command.equals("getAll")) {
				getAllEmployees(request, response);
			}
		} catch (Exception s) {
			request.setAttribute("errorMsg", s.getMessage());
			request.getRequestDispatcher("showError.jsp").forward(request, response);
			s.printStackTrace();
		}
	}

	public void getAllEmployees(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException, JSONException {
		JSONObject obj = new JSONObject();
		String url = "showError.jsp";
		try {
			JSONArray jArray = new JSONArray();
			for (Employees e : EmployeesDAO.getAllEmployees()) {
				JSONObject s = new JSONObject();
				s.put("employee_id", e.getEmployee_id());
				s.put("first_name", e.getFirst_name());
				s.put("last_name", e.getLast_name());
				s.put("email", e.getEmail());
				s.put("phone_number", e.getPhone_number());
				s.put("hire_date", e.getHire_date());
				s.put("job_id", e.getJob_id());
				s.put("salar", e.getSalary());
				s.put("commisson_pct", e.getCommisson_pct());
				s.put("manager_id", e.getManager_id());
				s.put("department_id", e.getDepartment_id());
				jArray.add(s);
			}
			obj.put("allEmployees", jArray);
			request.setAttribute("employeesAll", obj);
			url = "index.jsp";
		} catch (Exception s) {
			request.setAttribute("errorMsg", s.getMessage());
		}
		request.getRequestDispatcher(url).forward(request, response);
	}
}

```
EmployeesDAO.java
```java
package model;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import model.dto.Employees;
import model.util.DBUtil;

/*
 	private int employee_id;
	private String first_name;
	private String last_name;
	private String email;
	private String phone_number;
	private Date hire_date;
	private String job_id;
	private int salary;
	private int commisson_pct;
	private int manager_id;
	private int department_id;
 */

public class EmployeesDAO {
	public static ArrayList<Employees> getAllEmployees() throws SQLException{
		Connection con = null;
		PreparedStatement pstmt = null;
		ResultSet rset = null;
		ArrayList<Employees> list = null;
		try{
			con = DBUtil.getConnection();
			pstmt = con.prepareStatement("select * from employees");
			rset = pstmt.executeQuery();
			
			list = new ArrayList<Employees>();
			while(rset.next()){
				list.add(new Employees(
						rset.getInt(1),
						rset.getString(2),
						rset.getString(3),
						rset.getString(4),
						rset.getString(5),
						rset.getString(6),
						rset.getString(7),
						rset.getInt(8),
						rset.getInt(9),
						rset.getInt(10),
						rset.getInt(11)));
			}
		}finally{
			DBUtil.close(con, pstmt, rset);
		}
		return list;
	}
}	

```
Employees.java
```java
package model.dto;

import java.util.Date;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;
import lombok.ToString;

@NoArgsConstructor
@AllArgsConstructor
@Setter
@Getter
@ToString
public class Employees {
	private int employee_id;
	private String first_name;
	private String last_name;
	private String email;
	private String phone_number;
	private String hire_date;
	private String job_id;
	private int salary;
	private int commisson_pct;
	private int manager_id;
	private int department_id;
}

```
DBUtil.java
```java
package model.util;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.sql.DataSource;

public class DBUtil {
	
	private static DataSource source = null;

	//DataSource 객체에 server 내부에 설정된 정보를 기반으로 생성하는 코드
	static {
		try {
			Context ctx = new InitialContext();
			source = (DataSource) ctx.lookup("java:comp/env/jdbc/myoracle");
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public static Connection getConnection() throws SQLException{
		return source.getConnection();
	}

	// DML용
	public static void close(Connection con, Statement stmt) {
		try {
			if (stmt != null) {
				stmt.close();
				stmt = null;
			}
			if (con != null) {
				con.close();
				con = null;
			}
		} catch (SQLException s) {
			s.printStackTrace();
		}
	}

	// SELECT용
	public static void close(Connection con, Statement stmt, ResultSet rset) {
		try {
			if (rset != null) {
				rset.close();
				rset = null;
			}
			if (stmt != null) {
				stmt.close();
				stmt = null;
			}
			if (con != null) {
				con.close();
				con = null;
			}
		} catch (SQLException s) {
			s.printStackTrace();
		}
	}
}

```

